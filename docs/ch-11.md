# chapter-11

## CI / CD

### Amazon linux 2023 EC2 환경 설정

```bash
# nvm 설치
$ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash

# activate nvm
$ . ~/.nvm/nvm.sh

# NodeJS 18.14.2 설치
$ nvm install v18.14.2

# PM2 설치
$ npm install pm2 -g

# git 설치, SSH 로 레포를 클론할 수 있도록 SSH 키 생성 및 Github에 등록
# github -> 오른쪽 위 내 프로필 -> settings -> SSH and GPG keys -> New SSH key
$ sudo yum install git
$ ssh-keygen
$ cd ~/.ssh
$ ls -al
$ cat id_rsa.pub
$ git clone {ssh주소}

# docker, docker-compose
$ sudo yum update -y
$ sudo yum install docker -y
$ sudo service docker start
$ sudo usermod -aG docker ec2-user
$ docker run hello-world
$ sudo curl -L https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose
$ sudo chmod +x /usr/local/bin/docker-compose
$ docker-compose version

# DB
$ cd fastcampus-nestjs
$ docker-compose up -d
```

### Github Actions 설정

- .github/workflows/main.yml 작성

```bash
$ ssh-keygen -t rsa -b 4096 -C "fresh502@gmail.com"
# id_rsa.pub 복사해서 EC2에 .ssh/authorized_keys에 추가
# /.ssh/id_rsa 복사해서 Github repository -> settings -> secrets and variables -> Actions 에 KEY 추가. HOST_DEV, USERNAME 추가
```
